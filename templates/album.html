{% extends "base.html" %}

{% block title %}ìš°ë¦¬ì˜ ì•¨ë²”{% endblock %}

{% block content %}
    <h1>ìš°ë¦¬ì˜ ì¶”ì–µ ì•¨ë²”</h1>

    <form class="upload-form" action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
      <input type="file" name="file" accept="image/*" required>
      <button type="submit">ğŸ’– ì¶”ì–µ ì˜¬ë¦¬ê¸°</button>
    </form>

    <hr class="divider">

    <div class="photo-grid">
      {% if photos %}
        {% for photo in photos %}
          <div class="photo-item" data-src="{{ url_for('static', filename='images/' + photo) }}">
            <img src="{{ url_for('static', filename='images/' + photo) }}" alt="ì¶”ì–µ ì‚¬ì§„">
            <form class="delete-form" action="{{ url_for('delete_photo', filename=photo) }}" method="post" onsubmit="return confirm('ì •ë§ ì´ ì‚¬ì§„ì„ ì‚­ì œí• ê¹Œìš”?');">
              <button type="submit" class="delete-btn">Ã—</button>
            </form>
          </div>
        {% endfor %}
      {% else %}
        <p class="empty-album">ì•„ì§ ì•¨ë²”ì´ ë¹„ì–´ìˆì–´ìš”. ì²« ë²ˆì§¸ ì¶”ì–µì„ ì˜¬ë ¤ì£¼ì„¸ìš”!</p>
      {% endif %}
    </div>

    {% if total_pages > 1 %}
      <div class="pagination">
        {% if page > 1 %}<a href="{{ url_for('album', page=page-1) }}" class="nav-arrow">â† ì´ì „</a>{% else %}<span class="nav-arrow disabled">â† ì´ì „</span>{% endif %}
        <span class="page-info">í˜ì´ì§€ {{ page }} / {{ total_pages }}</span>
        {% if page < total_pages %}<a href="{{ url_for('album', page=page+1) }}" class="nav-arrow">ë‹¤ìŒ â†’</a>{% else %}<span class="nav-arrow disabled">ë‹¤ìŒ â†’</span>{% endif %}
      </div>
    {% endif %}

    <div id="lightbox" class="lightbox-overlay">
        <button id="lightbox-close" class="lightbox-btn lightbox-close">&times;</button>
        <button id="lightbox-prev" class="lightbox-btn lightbox-prev">â€¹</button>
        <div class="lightbox-content">
            <img id="lightbox-image" src="" alt="í™•ëŒ€ëœ ì‚¬ì§„" class="lightbox-image">
        </div>
        <button id="lightbox-next" class="lightbox-btn lightbox-next">â€º</button>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightbox-image');
        const photoItems = document.querySelectorAll('.photo-item');
        const photoSources = Array.from(photoItems).map(item => item.dataset.src);
        let currentIndex = 0;

        function showLightbox(index) {
            currentIndex = index;
            lightboxImage.src = photoSources[currentIndex];
            lightbox.classList.add('show');
            updateButtons();
        }

        function hideLightbox() {
            lightbox.classList.remove('show');
        }

        function showNext() {
            if (currentIndex < photoSources.length - 1) {
                showLightbox(currentIndex + 1);
            }
        }

        function showPrev() {
            if (currentIndex > 0) {
                showLightbox(currentIndex - 1);
            }
        }
        
        function updateButtons() {
            document.getElementById('lightbox-prev').style.display = (currentIndex === 0) ? 'none' : 'block';
            document.getElementById('lightbox-next').style.display = (currentIndex === photoSources.length - 1) ? 'none' : 'block';
        }

        photoItems.forEach((item, index) => {
            item.addEventListener('click', (e) => {
                // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ë¼ì´íŠ¸ë°•ìŠ¤ê°€ ì—´ë¦¬ì§€ ì•Šë„ë¡ í•¨
                if (e.target.classList.contains('delete-btn')) return;
                showLightbox(index);
            });
        });

        document.getElementById('lightbox-close').addEventListener('click', hideLightbox);
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) { // ì´ë¯¸ì§€ ë°”ê¹¥ì˜ ê²€ì€ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
                hideLightbox();
            }
        });
        document.getElementById('lightbox-next').addEventListener('click', showNext);
        document.getElementById('lightbox-prev').addEventListener('click', showPrev);

        // í‚¤ë³´ë“œ í™”ì‚´í‘œë¡œ ì‚¬ì§„ ë„˜ê¸°ê¸°
        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('show')) {
                if (e.key === 'ArrowRight') showNext();
                if (e.key === 'ArrowLeft') showPrev();
                if (e.key === 'Escape') hideLightbox();
            }
        });
    });
</script>
{% endblock %}